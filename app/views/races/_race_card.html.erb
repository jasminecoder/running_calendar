<%# Race card partial - displays a single race card %>
<%# Required local: race %>

<div data-testid="race-card-<%= race.id %>" class="race-card group bg-white rounded-lg overflow-hidden shadow-sm hover:shadow-lg transition-shadow duration-300">
  <%= link_to race_path(race), class: "block" do %>
    <%# Featured image with 16:9 aspect ratio %>
    <div class="relative aspect-video bg-gray-100">
      <%# Skeleton loading placeholder %>
      <div class="skeleton-loader absolute inset-0 bg-gray-200 animate-pulse"></div>

      <% if race.featured_image.attached? %>
        <%= image_tag race.featured_image,
            alt: race.name,
            class: "w-full h-full object-cover transition-opacity duration-300 group-hover:opacity-80",
            loading: "lazy",
            onload: "this.previousElementSibling.style.display='none'" %>
      <% else %>
        <%= image_tag "placeholder-race.jpg",
            alt: "Imagen de carrera",
            class: "w-full h-full object-cover transition-opacity duration-300 group-hover:opacity-80",
            onload: "this.previousElementSibling.style.display='none'" %>
      <% end %>
    </div>

    <%# Card content %>
    <div class="p-4">
      <%# Race name %>
      <h3 class="font-bold text-lg text-gray-900 mb-3 line-clamp-2"><%= race.name %></h3>

      <%# Line separator %>
      <hr class="border-t border-gray-200 mb-3" style="border-color: #E5E7EB;">

      <%# Date with calendar icon %>
      <div class="flex items-center text-gray-600 text-sm mb-2">
        <span data-testid="calendar-icon" class="mr-2 flex-shrink-0">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
        </span>
        <span><%= I18n.l(race.start_time.to_date, format: :full) %></span>
      </div>

      <%# Location with place icon %>
      <div class="flex items-start text-gray-600 text-sm mb-2">
        <span data-testid="place-icon" class="mr-2 flex-shrink-0 mt-0.5">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
        </span>
        <span class="line-clamp-2"><%= race.location_description %></span>
      </div>

      <%# Cost display %>
      <div class="flex items-center text-gray-700 text-sm mb-3">
        <span class="font-semibold"><%= format_race_cost(race.cost) %></span>
      </div>

      <%# Distance badges %>
      <% if race.race_distances.any? %>
        <div data-testid="distance-badges" class="flex flex-wrap gap-2 mb-2">
          <% race.race_distances.order(:distance_value).each do |distance| %>
            <span class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium border border-gray-300 text-gray-700 bg-gray-50">
              <%= distance.display_distance %>
            </span>
          <% end %>
        </div>
      <% end %>

      <%# City badge %>
      <div class="mt-2">
        <span class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium border border-gray-300 text-gray-700 bg-gray-50">
          <%= race.city.capitalize %>
        </span>
      </div>
    </div>
  <% end %>
</div>
